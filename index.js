// Generated by CoffeeScript 1.10.0
var _, dateformat, format;

dateformat = require('dateformat');

_ = require('lodash');

format = function(inputObj, options) {
  var columnHeaders, columnLengthArray, formatstr, i, j, k, key, keys, l, len, len1, len10, len2, len3, len4, len5, len6, len7, len8, len9, lineAr, linestr, longDashes, longStringOfSpaces, m, n, newStrAr, o, obj, p, partsMax, q, r, ref, ref1, rlen, s, sp, spacePad, spacePadLen, str, t, tempAr, u, v, val, w, x, y, z;
  options = options || {};
  lineAr = [];
  if (inputObj && inputObj.length) {
    obj = inputObj[0];
    keys = _.keys(obj);
    len = keys.length;
    partsMax = 1;
    columnLengthArray = {};
    if (options.longdateformat) {
      formatstr = 'mm/dd/yyyy  hh:MM tt';
    } else {
      formatstr = 'mmm dd  hh:MM tt';
    }
    for (i = m = 0, len1 = keys.length; m < len1; i = ++m) {
      key = keys[i];
      columnLengthArray[key] = 3;
      sp = key.split('.');
      for (p = 0, len2 = sp.length; p < len2; p++) {
        str = sp[p];
        columnLengthArray[key] = Math.max(columnLengthArray[key], str.length);
      }
      partsMax = Math.max(partsMax, sp.length);
    }
    for (j = q = 0, len3 = inputObj.length; q < len3; j = ++q) {
      obj = inputObj[j];
      for (k = r = 0, len4 = keys.length; r < len4; k = ++r) {
        key = keys[k];
        val = obj[key];
        if (val) {
          if (_.isDate(val)) {
            val = dateformat(val, formatstr);
          }
          columnLengthArray[key] = Math.max(val.toString().length, columnLengthArray[key]);
        }
      }
    }
    longStringOfSpaces = '                                                                                                                                                                                                                                                                                                ';
    longDashes = '------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------';
    linestr = '';
    newStrAr = [];
    for (i = s = 0, ref = partsMax; s < ref; i = s += 1) {
      newStrAr.push('');
    }
    for (l = t = 0, len5 = keys.length; t < len5; l = ++t) {
      key = keys[l];
      tempAr = [];
      for (i = u = 0, ref1 = partsMax; u < ref1; i = u += 1) {
        tempAr.push('');
      }
      sp = key.split('.');
      for (i = v = 0, len6 = sp.length; v < len6; i = ++v) {
        str = sp[i];
        tempAr[i] = str;
      }
      while (!tempAr[partsMax - 1]) {
        tempAr.pop();
        tempAr.unshift('');
      }
      for (i = w = 0, len7 = tempAr.length; w < len7; i = ++w) {
        str = tempAr[i];
        spacePadLen = columnLengthArray[key] + 1 - str.length;
        spacePad = longStringOfSpaces.slice(0, +spacePadLen + 1 || 9e9);
        newStrAr[i] += str + spacePad + " ";
      }
    }
    columnHeaders = newStrAr.join('\n');
    lineAr.push('');
    lineAr.push(columnHeaders);
    linestr = '';
    for (i = x = 0, len8 = keys.length; x < len8; i = ++x) {
      key = keys[i];
      linestr += longDashes.slice(1, +columnLengthArray[key] + 1 || 9e9) + "   ";
    }
    lineAr.push(linestr);
    for (n = y = 0, len9 = inputObj.length; y < len9; n = ++y) {
      obj = inputObj[n];
      linestr = '';
      for (o = z = 0, len10 = keys.length; z < len10; o = ++z) {
        key = keys[o];
        val = obj[key];
        if (_.isArray(val)) {
          val = JSON.stringify(val);
        }
        if (_.isBoolean(val)) {
          val = val.toString();
        }
        if (_.isNumber(val)) {
          val = _.trim(val.toString());
          len = val.length;
          spacePadLen = columnLengthArray[key] - len;
          spacePad = longStringOfSpaces.slice(1, +spacePadLen + 1 || 9e9);
          if (options.meetInMiddle) {
            if (spacePad.length > 60) {
              spacePad = spacePad.substring(0, 60);
            }
          }
          if (options.meetInMiddle && o % 2 === 1) {
            linestr += val + spacePad + "   ";
          } else {
            linestr += spacePad + val.toString() + "   ";
          }
        } else {
          if (toString.call(val) === '[object Date]') {
            val = dateformat(val, formatstr);
            val = val.replace(', 0', ',  ');
          }
          if (val == null) {
            val = '';
          }
          spacePadLen = columnLengthArray[key] + 1 - val.length;
          spacePad = longStringOfSpaces.slice(1, +spacePadLen + 1 || 9e9);
          if (options.meetInMiddle) {
            if (spacePad.length > 60) {
              spacePad = spacePad.substring(0, 60);
            }
          }
          if (options.meetInMiddle && o % 2 === 0) {
            spacePad = longStringOfSpaces.slice(2, +spacePadLen + 1 || 9e9);
            linestr += spacePad + val + "   ";
          } else {
            linestr += val + spacePad + "  ";
          }
        }
      }
      lineAr.push(linestr.substr(0, linestr.length - 2));
    }
    rlen = inputObj.length;
    if (rlen === 1) {
      lineAr.push("  (1 row returned)");
    } else {
      lineAr.push("  (" + rlen + " rows returned)");
    }
    lineAr.push('');
  } else {
    lineAr.push("  (0 rows returned)");
  }
  return lineAr.join('\n');
};

exports.format = format;
